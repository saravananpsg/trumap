<div class="page-home">
  <!-- <agm-map [latitude]="40.5" [longitude]="-80" [zoom]="12">
      <agm-marker *ngFor="let point of points | async" [latitude]="point.pos.geopoint.latitude" [longitude]="point.pos.geopoint.longitude">
          <agm-info-window>


              {{ point.queryMetadata | json }}

          </agm-info-window>
      </agm-marker>


      <agm-circle [latitude]="40.5" [longitude]="-80" [radius]="(radius | async) * 1000"></agm-circle>
  </agm-map>-->
  <mgl-map #mapbox
    [style]="'mapbox://styles/galvinw/cjki32wem35cb2ss2vhqr1tu1'"
    [zoom]="15"
    [center]="[103.837126, 1.352105]"
    [cursorStyle]="cursorStyle"
  >

    <mgl-geojson-source
      id="listings"
      [data]="geoListings">
    </mgl-geojson-source>

    <mgl-layer
      id="listings-custom"
      source="listings"
      type="symbol"
      [layout]="{
        'icon-image': '{icon}-15',
        'icon-allow-overlap': true
      }"
      (click)="onClick($event)"
      (mouseEnter)="cursorStyle = 'pointer'"
      (mouseLeave)="cursorStyle = ''"
      >
    </mgl-layer>
    <mgl-popup
      *ngIf="selectedPoint"
      [lngLat]="selectedPoint.geometry?.coordinates">
      <div class="flex flex-column flex-align-center"
        [innerHTML]="selectedPoint.properties?.description">
      </div>
    </mgl-popup>

    <!--<mgl-geojson-source
      id="listings"
      [data]="geoJSONListings?.data"
      [cluster]="true"
      [clusterMaxZoom]="19"
      [clusterRadius]="5">
    </mgl-geojson-source>

    <mgl-layer
      id="non-cluster-markers"
      type="symbol"
      [source]="geoJSONListings"
      [layout]="{
        'icon-image': 'marker-15'
      }"
      [paint]="{}"
      interactive="true"
      >
    </mgl-layer>


    <mgl-layer
      id="cluster-low"
      type="circle"
      [source]="geoJSONListings"
      [filter]="['<', 'point_count', 5]"
      [paint]="{
        'circle-color': '#1a9641',
        'circle-radius': 18
      }"
      interactive="true"
      >
    </mgl-layer>

    <mgl-layer
      id="cluster-medium"
      type="circle"
      [source]="geoJSONListings"
      [filter]=" [
        'all',
          ['>', 'point_count', 15],
          ['<=', 'point_count', 75]
      ]"
      [layout]="{}"
      [paint]="{
        'circle-color': '#ffffbf',
        'circle-radius': 18
      }"
      interactive="true"
      >
    </mgl-layer>



    <mgl-layer
      id="cluster-high"
      type="circle"
      [source]="geoJSONListings"
      [filter]="['>', 'point_count', 75]"
      [paint]="{
        'circle-color': '#fc8d59',
        'circle-radius': 18
      }"
      interactive="true"
      >
    </mgl-layer>

    <mgl-layer
      id="cluster-count"
      type="symbol"
      [source]="geoJSONListings"
      interactive="true"
      >
    </mgl-layer>-->
  </mgl-map>


  <!--<div class="tools">
      <h4>Query within Radius</h4>
      <pre>collection.within(center, radius, field)</pre>
      <p> <a routerLink="/pages/rt">DEMO 2 - Realtime Query</a> </p>
      <h6>Current Radius: {{ radius | async }}</h6>
      <h6>Documents Found: {{ (points | async)?.length }}</h6>

      <button class="btn btn-secondary btn-sm"
        [disabled]="(radius | async) === 0.25" (click)="update(0.25)">Query to 0.25km</button>
      <button class="btn btn-secondary btn-sm"
        [disabled]="(radius | async) === 5" (click)="update(5)">Query to 5km</button>
      <button class="btn btn-secondary btn-sm"
        [disabled]="(radius | async) === 10" (click)="update(10)">Query to 10km</button>
      <button class="btn btn-secondary btn-sm"
        [disabled]="(radius | async) === 25" (click)="update(25)">Query to 25km</button>
      <button class="btn btn-secondary btn-sm"
        [disabled]="(radius | async) === 1500" (click)="update(1500)">Query to 1500km</button>
  </div>-->
  <div class="top-toolbar">
    <ngx-toolbar (onZoomSelected)="changeZoom($event)"></ngx-toolbar>
  </div>
  <div class="footer-toolbar">
    <ngx-listing  #listings (onAddListings)="addListings($event)"></ngx-listing>
  </div>

</div>
